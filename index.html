<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Crack.ai — Quest 3 Controller Ready Demo</title>

  <!-- A-Frame core -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!-- Optional components for hand/controller interactions -->
  <script src="https://unpkg.com/aframe-super-hands-component/dist/aframe-super-hands.min.js"></script>
  <script src="https://unpkg.com/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js"></script>
  <!-- event-set is handy for hover enter/leave states -->
  <script src="https://cdn.jsdelivr.net/npm/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #000; color: #fff; }
    .hint {
      position: fixed; left: 50%; transform: translateX(-50%); top: 8px;
      background: rgba(0,0,0,0.6); padding:8px 12px; border-radius:8px; z-index: 10;
      font-size: 13px; pointer-events: none;
    }
    .devlog {
      position: fixed; right: 12px; bottom: 12px; background: rgba(0,0,0,0.6);
      color: #cfcfd0; padding:10px 12px; border-radius:8px; font-size:12px;
      max-width: 320px; pointer-events: auto;
    }
    .devlog pre { margin:0; font-size:12px; max-height: 200px; overflow:auto; }
  </style>
</head>

<body>
  <div class="hint">Tip: Put on Meta Quest 3 → open browser → load this page → press VR button → use triggers to interact</div>
  <div class="devlog" id="log"><strong>Dev Log</strong><pre id="logPre">starting…</pre></div>

  <!-- A-Frame scene: enable WebXR features useful for Quest3 -->
  <a-scene
    webxr="optionalFeatures: local-floor, hand-tracking, bounded-floor"
    renderer="antialias: true; colorManagement: true"
    physics="driver: cannon"
    background="color: #010014"
    cursor="rayOrigin: mouse"
  >

    <!-- lighting & sky -->
    <a-entity light="type: hemisphere; skyColor: #b3a2ff; groundColor: #05040a; intensity: 0.9"></a-entity>
    <a-entity light="type: directional; color: #7d5cff; intensity: 0.6" position="2 5 1"></a-entity>
    <a-sky color="#070317"></a-sky>

    <!-- floor -->
    <a-plane rotation="-90 0 0" width="60" height="60" color="#04030a" material="roughness:0.95; metalness:0.02" static-body></a-plane>

    <!-- Camera rig -->
    <a-entity id="rig" position="0 1.6 4">
      <a-entity id="camera" camera look-controls wasd-controls="acceleration: 20"></a-entity>

      <!-- Visual reticle for gaze fallback (not used when controllers present) -->
      <a-entity cursor="fuse:false; rayOrigin: mouse" raycaster="objects: .clickable" position="0 0 -1">
        <a-ring radius-inner="0.005" radius-outer="0.01" color="#fff"></a-ring>
      </a-entity>

      <!-- LEFT controller: will map automatically to Quest left controller -->
      <a-entity id="leftController"
                laser-controls="hand: left; model: true"
                oculus-touch-controls="hand: left"
                super-hands="colliderEvent: collisions; colliderEventProperty: els; grabStartButtons: triggerdown; grabEndButtons: triggerup"
                raycaster="objects: .clickable"
                line="color: #6AE3FF; opacity: 0.9"
      ></a-entity>

      <!-- RIGHT controller: will map automatically to Quest right controller -->
      <a-entity id="rightController"
                laser-controls="hand: right; model: true"
                oculus-touch-controls="hand: right"
                super-hands="colliderEvent: collisions; colliderEventProperty: els; grabStartButtons: triggerdown; grabEndButtons: triggerup"
                raycaster="objects: .clickable"
                line="color: #B36AF5; opacity: 0.95"
      ></a-entity>

      <!-- Hand tracking fallback entities (invisible unless hand-tracking active) -->
      <a-entity id="leftHand" hand-tracking-controls="hand: left"></a-entity>
      <a-entity id="rightHand" hand-tracking-controls="hand: right"></a-entity>
    </a-entity>

    <!-- Teleport rings (clickable) -->
    <a-entity id="teleportTargets">
      <a-ring class="clickable teleport-target" position="-3 0.15 -2" rotation="-90 0 0" color="#2a1736" radius-inner="0.6" radius-outer="0.78" material="emissive:#5D3B91; emissiveIntensity:0.2"></a-ring>
      <a-text value="Hub" position="-3 0.6 -2" align="center" color="#d6b7ff"></a-text>

      <a-ring class="clickable teleport-target" position="0 0.15 -2.5" rotation="-90 0 0" color="#10101a" radius-inner="0.6" radius-outer="0.78" material="emissive:#6AE3FF; emissiveIntensity:0.15"></a-ring>
      <a-text value="Lecture" position="0 0.6 -2.5" align="center" color="#9fefff"></a-text>

      <a-ring class="clickable teleport-target" position="3 0.15 -2" rotation="-90 0 0" color="#0b0810" radius-inner="0.6" radius-outer="0.78" material="emissive:#B36AF5; emissiveIntensity:0.18"></a-ring>
      <a-text value="Explore" position="3 0.6 -2" align="center" color="#f0d7ff"></a-text>
    </a-entity>

    <!-- Interactable demo objects -->
    <a-box class="clickable" position="-1 1 -1.8" depth="0.45" height="0.45" width="0.45" color="#6AE3FF"
           event-set__mouseenter="_event: mouseenter; scale: 1.08 1.08 1.08"
           event-set__mouseleave="_event: mouseleave; scale: 1 1 1"
           grabbable
           dynamic-body>
      <a-text value="Grab Me" align="center" color="#001221" position="0 0 0.26" width="1.5"></a-text>
    </a-box>

    <a-sphere class="clickable" position="1 1 -2.2" radius="0.28" color="#B36AF5"
              event-set__mouseenter="_event: mouseenter; scale: 1.08 1.08 1.08"
              event-set__mouseleave="_event: mouseleave; scale: 1 1 1"
              grabbable
              dynamic-body>
      <a-text value="Pick" align="center" color="#fff" width="1.2" position="0 0 0.3"></a-text>
    </a-sphere>

    <!-- Interactive panel to test triggerdown event -->
    <a-entity id="uiPanel" position="0 1.3 -1.1">
      <a-plane class="clickable" width="1.8" height="0.9" color="#0b0b10" opacity="0.95"></a-plane>
      <a-text value="Press trigger to toggle video" width="1.6" color="#e8dfff" position="0 0.28 0.02"></a-text>
      <a-entity id="playButton" class="clickable" geometry="primitive: plane; width:0.9; height:0.26" material="color:#151224" position="0 -0.22 0.02" event-set_enter="material.color:#1c1530" event-set_leave="material.color:#151224">
        <a-text id="playLabel" value="Play / Pause" color="#fff" width="1.2" align="center" position="0 0 0.01"></a-text>
      </a-entity>
    </a-entity>

    <!-- Demo video panel (use mp4) -->
    <a-entity position="0 1.6 -3.2">
      <a-plane width="3.6" height="2.1" material="color:#000; opacity:0.92"></a-plane>
      <a-video id="demoVideo" src="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4"
               width="3.2" height="1.8" position="0 0 0.02"></a-video>
    </a-entity>

  </a-scene>

  <script>
    // Basic dev log helper
    const logPre = document.getElementById('logPre');
    function log(msg){
      console.log(msg);
      logPre.textContent = (logPre.textContent + '\\n' + msg).slice(-6000);
    }

    // Wait until A-Frame scene is ready
    window.addEventListener('load', () => {
      const scene = document.querySelector('a-scene');
      if (!scene) { log('A-Frame scene not found'); return; }

      scene.addEventListener('enter-vr', (e) => log('Entered VR mode'));
      scene.addEventListener('exit-vr', (e) => log('Exited VR mode'));
      scene.addEventListener('loaded', () => log('Scene loaded'));

      // Controllers
      const left = document.getElementById('leftController');
      const right = document.getElementById('rightController');

      // Basic event listeners for the controllers
      [left, right].forEach((ctrl, idx) => {
        if(!ctrl) return;
        const handName = idx===0 ? 'left' : 'right';

        // XR input button events (common for many controllers)
        ctrl.addEventListener('triggerdown', (ev) => {
          log(${handName} triggerdown);
          // Example: if pointing at playButton, trigger toggles video
          checkUIInteraction(ev, 'triggerdown');
        });
        ctrl.addEventListener('triggerup', (ev) => {
          log(${handName} triggerup);
        });
        ctrl.addEventListener('gripdown', (ev) => {
          log(${handName} gripdown);
        });
        ctrl.addEventListener('gripup', (ev) => {
          log(${handName} gripup);
        });

        // super-hands events (grab)
        ctrl.addEventListener('grab-start', (ev) => {
          const target = ev.detail && ev.detail.hand && ev.detail.hand.el ? ev.detail.hand.el : (ev.detail && ev.detail grabbed ? ev.detail.grabbed : null);
          log(${handName} grab-start on ${ev.detail && ev.detail.hand ? ev.detail.hand.el.id || ev.detail.hand.el.tagName : 'unknown'});
        });
        ctrl.addEventListener('grab-end', (ev) => {
          log(${handName} grab-end);
        });

        // When controller ray hits an element, raycaster-intersection event provides details
        ctrl.addEventListener('raycaster-intersection', (ev) => {
          // ev.detail.els is array of intersected elements
          // log(${handName} intersect: ${ev.detail.els.map(e=>e.id||e.tagName).join(',')});
        });
      });

      // Simple UI: toggle video when playButton is clicked via any controller
      const playButton = document.getElementById('playButton');
      const demoVideo = document.getElementById('demoVideo');

      // Clicking with controllers triggers normal 'click' events on entities with .clickable
      playButton.addEventListener('click', () => {
        if(!demoVideo) return;
        const comp = demoVideo.components.sound || demoVideo;
        // For <a-video>, use play/pause methods
        if(demoVideo.paused !== undefined){
          demoVideo.paused ? demoVideo.play() : demoVideo.pause();
          log(Video toggled; paused: ${demoVideo.paused});
        } else {
          // fallback
          log('Video element missing play/pause API');
        }
      });

      // Teleportation: clicking any .teleport-target moves rig to that position (with small offset)
      document.querySelectorAll('.teleport-target').forEach(el => {
        el.addEventListener('click', () => {
          const rig = document.getElementById('rig');
          const posAttr = el.getAttribute('position');
          if (posAttr && rig) {
            // move rig to same x,z but slightly behind the ring and keep y at 1.6
            const nx = posAttr.x || posAttr[0] || 0;
            const nz = posAttr.z || posAttr[2] || 0;
            rig.setAttribute('position', ${nx} 1.6 ${nz + 1.2});
            log(Teleported to ${nx},${nz});
          }
        });
      });

      // Ensure hands/controllers are displayed for Quest devices
      // If hand-tracking active, 'hand-tracking-detector' events may be used in custom components
      log('Initialization complete — ready to use controllers and hand tracking.');
    });

  </script>
</body>
</html>